<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/Layouts}">

<head>
    <meta charset="utf-8">
    <title>라이더 메인</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <!-- 내 CSS -->
    <link th:href="@{/css/custom.css}" rel="stylesheet" />
    <link th:href="@{/css/index.css}" rel="stylesheet" />
    <link th:href="@{/css/infopage.css}" rel="stylesheet" />
<script th:src="@{/js/hideLogo.js}"></script>
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <div id="map"></div>
    </div>

    <div layout:fragment="js">
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // 지도 초기화
                const map = L.map('map').setView([37.5665, 126.9780], 13);

                // 지도 타일 레이어 추가
                L.tileLayer(
                    'https://api.maptiler.com/maps/voyager/{z}/{x}/{y}.png?key=WQbZM22ttxB5OGQ2cihA',
                    {
                        attribution: '© MapTiler',
                    }
                ).addTo(map);

                // 마커 객체 배열 (주문이 들어올 때마다 마커를 추가할 예정)
                const markers = [];

                // 초기 마커 추가
                function addInitialMarker(lat, lng, message) {
                    let marker = L.marker([lat, lng]).addTo(map)
                        .bindPopup(message)
                        .openPopup();
                    markers.push(marker); // 배열에 마커 추가
                }

                // 예시: 서울에 초기 마커 추가
                addInitialMarker(37.5665, 126.9780, '서울입니다!');

                // 주기적으로 마커를 추가하는 함수 (예시로 사용)
                function addNewOrderMarker(lat, lng, message) {
                    let marker = L.marker([lat, lng]).addTo(map)
                        .bindPopup(message);
                    markers.push(marker); // 새로운 마커를 배열에 추가
                }

                // 5초마다 새로운 주문 마커 추가 예시
                setInterval(function () {
                    // 예시로 5초마다 새로운 주문 위치를 추가합니다.
                    // 실제로는 서버에서 주문 데이터를 받아와서 사용해야 합니다.
                    let lat = 37.5665 + Math.random() * 0.01;  // 임의로 좌표 생성
                    let lng = 126.9780 + Math.random() * 0.01;  // 임의로 좌표 생성
                    let message = '새로운 주문이 들어왔습니다!';

                    addNewOrderMarker(lat, lng, message); // 새로운 주문 마커 추가
                }, 5000); // 5초마다 마커 추가
            });
        </script>
    </div>

</body>

</html>
