<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/Layouts}">
<head>
<link th:fragment="css" th:href="@{/css/OwnerCustom.css}" rel="stylesheet" />
<link th:fragment="css" th:href="@{/css/storeMenuManage/sales.css}" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
<link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css"
        rel="stylesheet">
<script
        src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<meta charset="UTF-8">
<title>ì˜¨ë‹¬</title>
</head>
<body>
<div layout:fragment="content" class="container">

<!-- ìš”ì•½ ì¹´ë“œ -->
<h1>ğŸ“Š ì ì£¼ ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ</h1>

  <section class="summary-cards">
      <div class="card">ğŸ’° ì´ ë§¤ì¶œ: <span th:text="${totalSales}">0</span>ì›</div>
      <div class="card">ğŸ’µ ì´ ë¶€ê°€ì„¸: <span th:text="${totalVat}">0</span>ì›</div>
      <div class="card">ğŸª ê°€ê²Œ ìˆ˜: <span th:text="${storeCount}">0</span>ê°œ</div>
  </section>

  <section class="filter">
      <form method="get" th:action="@{/owner/sales}">
          <label for="period">ê¸°ê°„:</label>
          <select name="period" id="period" onchange="toggleDateInputs()">
              <option value="thisMonth" th:selected="${period == 'thisMonth'}">ì´ë²ˆ ë‹¬</option>
              <option value="lastMonth" th:selected="${period == 'lastMonth'}">ì§€ë‚œ ë‹¬</option>
              <option value="custom" th:selected="${period == 'custom'}">ì§ì ‘ ì„¤ì •</option>
          </select>
          <input type="date" name="start" id="startDate" th:value="${start}" disabled />
          <input type="date" name="end" id="endDate" th:value="${end}" disabled />
          <button type="submit">ì¡°íšŒ</button>
      </form>
  </section>
<script>
function toggleDateInputs() {
    const period = document.getElementById('period').value;
    const start = document.getElementById('startDate');
    const end = document.getElementById('endDate');
    if (period === 'custom') {
        start.disabled = false;
        end.disabled = false;
    } else {
        start.disabled = true;
        end.disabled = true;
        start.value = '';
        end.value = '';
    }
}
// í˜ì´ì§€ ë¡œë“œì‹œ ìƒíƒœ ë°˜ì˜
window.onload = toggleDateInputs;
</script>
<!-- ê°€ê²Œë³„ ë§¤ì¶œ ì¹´ë“œ -->
<section class="store-sales">
      <div th:each="storeStat : ${storeSalesList}" class="store-card">
          <h3 th:text="${storeStat.storeName}">ê°€ê²Œ ì´ë¦„</h3>
          <p>ë§¤ì¶œ: <span th:text="${storeStat.totalSales}">0</span>ì›</p>
          <p>ì „ì›”ëŒ€ë¹„: <span th:text="${storeStat.diffPercent}">0%</span></p>
          <a th:href="@{/owner/sales/store/{id}(id=${storeStat.storeId})}">ìƒì„¸ë³´ê¸°</a>
      </div>
  </section>


<!-- ê·¸ë˜í”„ (ì°¨íŠ¸.js) -->
<section class="sales-chart">
    <canvas id="salesChart"></canvas>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    const monthLabels = /*[[${monthLabels}]]*/ ['1ì›”', '2ì›”', '3ì›”'];
    const monthlySales = /*[[${monthlySales}]]*/ [1000000, 2000000, 2500000];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [{
                label: 'ì›”ë³„ ë§¤ì¶œ',
                data: monthlySales,
                borderColor: 'blue',
                fill: false,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + 'ì›'; // 1000ë‹¨ìœ„ ì½¤ë§ˆ + ì› í‘œì‹œ
                        }
                    }
                }
            }
        }
    });
</script>
</div>
</body>
</html>