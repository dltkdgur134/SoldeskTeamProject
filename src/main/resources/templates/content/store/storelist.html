<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/Layouts}">
<head>
	<link th:fragment="css" th:href="@{/css/index.css}" rel="stylesheet"/>
	<link th:fragment="css" th:href="@{/css/index2.css}" rel="stylesheet"/>
	<link th:fragment="css" th:href="@{/css/ownerCustom.css}" rel="stylesheet"/>
	<!--<link th:fragment="css" th:href="@{/css/storeRegSubmit.css}" rel="stylesheet"/>-->
	<!--<link rel="stylesheet" th:href="@{/css/storeRegSubmit.css}">-->
	<link rel="stylesheet" th:href="@{/css/storelist.css}">
</head>
<body>
    <div layout:fragment="content">
	  	<div class="d-flex justify-content-center px-5">
        	<div class="search"> 
        		<input type="text" class="search-input" placeholder="ë­ ë¨¹ì„ê¹Œ?" name=""> 
        		<a href="#" class="search-icon"> <i class="fa fa-search"></i> </a> 
        	</div>
        </div>
		<div class="food-buttons">
			<button class="food-btn" onclick="loadCategory('fastfood', this)">íŒ¨ìŠ¤íŠ¸í‘¸ë“œ</button>
		    <button class="food-btn" onclick="loadCategory('cn', this)">ì¤‘ì‹</button>
		    <button class="food-btn" onclick="loadCategory('kr', this)">í•œì‹</button>
		    <button class="food-btn" onclick="loadCategory('bunsik', this)">ë¶„ì‹</button>
		    <button class="food-btn" onclick="loadCategory('chicken', this)">ì¹˜í‚¨</button>
		    <button class="food-btn" onclick="loadCategory('pizza', this)">í”¼ì</button>
		    <button class="food-btn" onclick="loadCategory('jjimtang', this)">ì°œ.íƒ•</button>
		    <button class="food-btn" onclick="loadCategory('jp', this)">ì¼ì‹</button>
		    <button class="food-btn" onclick="loadCategory('roast', this)">êµ¬ì´</button>
		    <button class="food-btn" onclick="loadCategory('caffe', this)">ì¹´í˜</button>
		</div>
		<div id="gallery-area">
			<div class="gallery-container">
				<div><a href="#" class="labels">ê¸°ë³¸ ê°€ê²Œ</a><img class="imgs" src="/css/imgs/img1.png"></div>
			</div>
		</div>
	</div>
	<div layout:fragment="js">
		<script th:inline="javascript">
			const selectedCategory = /*[[${selectedCategory}]]*/ null;
		</script>
		<script>
			const categoryMap = {
				fastfood: "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ",
				cn: "ì¤‘ì‹",
				kr: "í•œì‹",
				bunsik: "ë¶„ì‹",
				chicken: "ì¹˜í‚¨",
				pizza: "í”¼ì",
				jjimtang: "ì°œÂ·íƒ•",
				roast: "êµ¬ì´",
				jp: "ì¼ì‹",
				caffe: "ì¹´í˜"
			};
				
			function loadCategory(category, btn) {
				document.querySelectorAll(".food-btn").forEach(b => b.classList.remove("active"));
				btn.classList.add("active");
				
				fetch(`/api/stores/${category}`)
					.then(res => res.json())
					.then(data => {
						console.log("ë°›ì•„ì˜¨ ë°ì´í„°", data);
						const gallery = document.querySelector("#gallery-area");
						gallery.innerHTML = `
							${
								data
									.filter(store => !['PENDING_APPROVAL', 'PENDING_REFUSES', 'BANNED', 'SUSPENDED'].includes(store.storeStatus))
									.map(store => {
										const isClosed = store.storeStatus === 'CLOSED';
									const imageSection = `
										<div class="store-image-wrapper ${isClosed ? 'closed' : ''}">
											<img class="store-image" src="${store.imageUrl}" alt="${store.storeName}">
											${isClosed ? '<div class="overlay-text">ì¤€ë¹„ì¤‘</div>' : ''}
										</div>
									`;

									const storeInfo = `
										<div class="store-info">
											<p class="store-category">[${categoryMap[store.category] || store.category}]</p>
											<p class="store-name">
												${store.storeName}
												<span style="font-size: 12px; color: #444; margin-left: 5px;">
													<span style="color: gold;">ğŸŒœ</span> ${store.avgRating.toFixed(1)} (${store.reviewCount})
												</span>
											</p>
											<p class="store-delivery">ë¬´ë£Œë°°ë‹¬ ìµœì†Œì£¼ë¬¸ 10,000ì› </p>
										</div>
									`;

									return isClosed
										? `
											<div class="store-list disabled">
												<div class="store-row">
													${imageSection}
													${storeInfo}
												</div>
											</div>
										`
										: `
											<a class="store-list" href="/store/view/${store.storeId}">
												<div class="store-row">
													${imageSection}
													${storeInfo}
												</div>
											</a>
										`;
								}).join("")
							}
						`;
					})
					.catch(error => console.error("ê°€ê²Œ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ", error));
			}
			
			document.addEventListener("DOMContentLoaded", () => {
				if (selectedCategory) {
					const btn = document.querySelector(`.food-btn[onclick*="${selectedCategory}"]`);
					loadCategory(selectedCategory, btn);
				}
			});
		</script>
	</div>
</body>
</html>