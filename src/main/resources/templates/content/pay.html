<!DOCTYPE html>
<html 
	lang="ko"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/Layouts}"
>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>온라인 배달 – 결제</title>

  
  <!-- Bootstrap & Icons -->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
-->  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
	<link th:href="@{/css/custom.css}" rel="stylesheet" />
	
	<script src="https://js.tosspayments.com/v1"></script>
	<script>
	  window.addEventListener("DOMContentLoaded", function () {
	    const payBtn = document.getElementById("pay-btn");

	    if (!payBtn) {
	      console.error("결제 버튼이 문서에 존재하지 않습니다.");
	      return;
	    }

	    payBtn.addEventListener("click", function () {
	      const tossPayments = TossPayments("test_ck_Z61JOxRQVEEOgm2alYRRVW0X9bAq");

	      tossPayments.requestPayment({
	        amount: 1,
	        orderId: "321231dsa",
	        orderName: "kimchi",
	        successUrl: "https://ondal.com",
	        failUrl: "https://ondal.com",
	        method: "CARD"
	      });
	    });
	  });
	</script>
  <style>
    /* ──────── 컬러 팔레트 & 기본 글꼴 ──────── */
    :root {
      --brand-yellow: #ffe65d;
      --brand-border: #000000;
    }

    body {
      background-color: #ffffff;
      font-family: "Pretendard", "Noto Sans KR", sans-serif;
      color: #000;
    }

    /* ──────── 상단 네비게이션 ──────── */
    .navbar-custom {
      background-color: var(--brand-yellow);
    }

    .back-btn {
      font-size: 1.7rem;
      color: #000;
    }

    /* ──────── 장바구니 아이템 ──────── */
    .cart-item-img {
      width: 72px;
      height: 72px;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid var(--brand-border);
    }

    /* ──────── 섹션 헤드라인 ──────── */
    .section-title {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.4rem;
    }

    /* ──────── 고정 요약 박스 ──────── */
    #summaryBox {
      position: sticky;
      top: 85px;
    }

    .price-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
    }

    .total-price {
      font-size: 1.25rem;
      font-weight: 700;
    }

    /* ──────── 반응형 레이아웃 개선 ──────── */
    @media (max-width: 991.98px) {
      #summaryBox {
        top: auto;
        margin-top: 1.5rem;
      }
    }
  </style>
</head>
<body>


  <!-- ────────── 메인 컨테이너 ────────── -->
  <div layout:fragment = "content" class="container py-4">
    <div class="row g-4">
      <!-- ──────── 좌측: 주문 세부 ──────── -->
      <div class="col-lg-8 order-1 order-lg-0">
        <!-- 장바구니 -->
        <h5 class="section-title">담은 메뉴</h5>
		<div id="cartItems" class="list-group mb-4" th:each="item : ${cids}">
		    <div class="list-group-item py-3 d-flex align-items-center">
		      <img th:src="${item.menuImg}" alt="상품 이미지" class="cart-item-img me-3" />
		      <div class="flex-grow-1">
		        <div class="d-flex justify-content-between">
		          <strong th:text="${item.menuName}">상품명</strong>
		          <span th:text="'₩' + ${#numbers.formatInteger(item.totalPrice, 0)}">₩0</span>
		        </div>
		        <small class="text-muted" th:text="${item.optionNames}">옵션정보</small>
		      </div>
		    </div>
		  </div>

        <!-- 주소 & 라이더 요청사항 -->
        <div class="row g-3 align-items-start mb-4">
          <div class="col-lg-6">
            <div class="section-title">배달 주소</div>
            <p class="mb-1"><strong id="roadName" th:text="${userInfo.userLoc}"></strong></p>
            <p class="mb-2 text-muted" id="detailAddress" th:text="${userInfo.userSepLoc}">301호, 온달빌딩</p>
            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#addressModal">변경</button>
          </div>
          <div class="col-lg-6">
            <div class="section-title">라이더 요청사항</div>
            <textarea class="form-control" rows="3" placeholder="예: 문 앞에 두고 벨 눌러주세요"></textarea>
          </div>
        </div>

        <!-- 연락처 -->
        <div class="mb-3">
          <div class="section-title">내 연락처</div>
          <input type="tel" class="form-control" th:text="${userInfo.userTel}" readonly/>
        </div>

        <!-- 가게 요청사항 -->
        <div class="mb-4">
          <div class="section-title">가게 요청사항</div>
          <textarea class="form-control" rows="3" placeholder="예: 덜 맵게 해주세요"></textarea>
        </div>

        <!-- 이용 약관 동의 -->
        <div>
          <div class="section-title">이용 약관 동의</div>
          <div class="form-check mb-1">
            <input class="form-check-input term-check" type="checkbox" id="term1" />
            <label class="form-check-label" for="term1">[필수] 서비스 이용약관 동의</label>
          </div>
          <div class="form-check mb-1">
            <input class="form-check-input term-check" type="checkbox" id="term2" />
            <label class="form-check-label" for="term2">[필수] 개인정보 처리방침 동의</label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input term-check" type="checkbox" id="term3" />
            <label class="form-check-label" for="term3">[선택] 마케팅 정보 수신 동의</label>
          </div>
        </div>
      </div>

      <!-- ──────── 우측: 결제 요약 ──────── -->
      <div class="col-lg-4">
        <div id="summaryBox" class="border rounded-4 p-4 shadow-sm bg-white">
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="allAgree"																																						 />
            <label class="form-check-label fw-bold" for="allAgree">모든 항목 동의</label>
          </div>

          <div class="price-line mb-1"><span>상품 합계</span><span id="subtotal">₩10,000</span></div>
          <div class="price-line mb-1"><span>할인</span><span id="discount">-₩1,000</span></div>
          <hr />
          <div class="price-line total-price">
            <span>총 결제금액</span><span id="totalPrice">₩9,000</span>
          </div>
          <button class="btn btn-primary w-100 btn-lg mt-3" id="pay-btn">₩9,000 결제하기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ────────── 주소 변경 모달 ────────── -->
  <div class="modal fade" id="addressModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">배달 주소 변경</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">도로명 주소</label>
            <input type="text" class="form-control" id="newRoad" />
          </div>
          <div class="mb-3">
            <label class="form-label">상세 주소</label>
            <input type="text" class="form-control" id="newDetail" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="saveAddress">저장</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ────────── 스크립트 ────────── -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 모든 약관 동의 토글 처리
    document.getElementById("allAgree").addEventListener("change", (e) => {
      document.querySelectorAll(".term-check").forEach((cb) => {
        cb.checked = e.target.checked;
      });
    });

    // 주소 모달 저장
    document.getElementById("saveAddress").addEventListener("click", () => {
      const road = document.getElementById("newRoad").value;
      const detail = document.getElementById("newDetail").value;
      if (road) document.getElementById("roadName").textContent = road;
      if (detail) document.getElementById("detailAddress").textContent = detail;
      bootstrap.Modal.getInstance(document.getElementById("addressModal")).hide();
    });
  </script>
</body>
</html>