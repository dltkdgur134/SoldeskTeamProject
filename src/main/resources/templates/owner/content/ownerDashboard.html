<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css"/>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- SockJS / STOMP ë¼ì´ë¸ŒëŸ¬ë¦¬ -->    
	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/webjars/org.webjars/stomp-websocket/2.3.4/stomp.min.js"></script>
	<!-- Popper and Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Styles -->
    <style>
	    body { padding: 20px; background-color: #f5f5f5; }
	    #orderList { background-color: #fff; padding: 20px; border-radius: 10px; margin-right: 20px; }
	    #orderDetail { background-color: #fff; padding: 20px; border-radius: 10px; }
	    #newOrdersArea h4, #processingOrdersArea h4 {
	      background-color: #2D7121;
	      color: white;
	      padding: 10px;
	      border-radius: 5px;
	      margin-bottom: 10px;
	    }
	    ul { list-style: none; padding-left: 0; }
	    .order-item {
		    border-bottom: 1px solid #ccc;
		    padding: 10px;
		    display: flex;
		    justify-content: space-between;
		    align-items: center;
		    gap: 10px;
		}
		.order-text {
		    font-size: 14px;
		    white-space: pre-line;
		    flex-grow: 1;
		}
		.order-buttons {
		    flex-shrink: 0;
		}
		.time-adjust input {
		    width: 35px;
		    height: 30px;
		}
	    .order-buttons button {
	      margin-left: 5px;
	      border: 1px solid #2D7121;
	      background-color: #e8f5e9;
	      color: #2D7121;
	      border-radius: 4px;
	      padding: 2px 8px;
	    }
	    .time-controls {
	      display: flex;
	      align-items: center;
	      margin-left: 10px;
	    }
	    .time-controls button {
	      font-size: 12px;
	      padding: 2px 6px;
	      margin: 0 2px;
	    }
	    .time-controls input {
	      width: 40px;
	      text-align: center;
	      font-size: 12px;
	    }
	    .countdown-timer {
		  width: 50px;
		  height: 50px;
		  position: relative;
		  margin-left: 10px;
		}
		
		.circle {
		  width: 100%;
		  height: 100%;
		  border-radius: 50%;
		  background: conic-gradient(#2D7121 calc(var(--progress, 100) * 1%), #ddd 0%);
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  transition: background 0.3s linear;
		}
		
		.circle.overdue {
		  background: conic-gradient(red calc(var(--progress, 0) * 1%), #ddd 0%);
		}
		
		.inside-text {
		  position: absolute;
		  font-size: 11px;
		  font-weight: bold;
		  color: #000;
		  background-color: rgba(255, 255, 255, 0.7); /* âœ… ì¤‘ì•™ í…ìŠ¤íŠ¸ ê°€ë…ì„± ê°œì„  */
		  border-radius: 50%;
		  padding: 4px;
		}
	    .dashboard-container {
	      display: flex;
	      flex-direction: row;
	      justify-content: space-between;
	      align-items: flex-start;
	      gap: 20px;
	    }
	    #orderList, #orderDetail {
	      flex: 1;
	      min-width: 0;
	    }
	    #deliveringOrdersArea h4 {
		  background-color: #0056b3;
		  color: white;
		  padding: 10px;
		  border-radius: 5px;
		  margin-top: 20px;
		}
    </style>
</head>
<body>	
  <div class="container-fluid py-4 px-5">
    <div class="row g-4">
      <div class="col-md-6" id="orderList">
        <h3 class="mb-4">ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸</h3>
        <div id="newOrdersArea" class="p-3 mb-4 rounded shadow-sm" style="background-color: #e9f5ec;">
          <h4 class="fw-bold text-success mb-3">ì‹ ê·œ ì£¼ë¬¸</h4>
          <ul id="newOrderList" class="list-unstyled m-0"></ul>
        </div>
        <div id="processingOrdersArea" class="p-3 rounded shadow-sm" style="background-color: #f7f7f7;">
          <h4 class="fw-bold text-primary mb-3">ì§„í–‰ì¤‘ ì£¼ë¬¸</h4>
          <ul id="processingOrderList" class="list-unstyled m-0"></ul>
        </div>
        <div id="deliveringOrdersArea" class="p-3 rounded shadow-sm" style="background-color: #fff3cd;">
          <h4 class="fw-bold text-warning mb-3">ë°°ë‹¬ì¤‘ ì£¼ë¬¸</h4>
          <ul id="deliveringOrderList" class="list-unstyled m-0"></ul>
        </div>
      </div>
      <div class="col-md-6" id="orderDetail">
        <h3 class="mb-4">ì£¼ë¬¸ ìƒì„¸</h3>
        <div class="mb-2">ì£¼ë¬¸ë²ˆí˜¸: <span id="detailOrderId"></span></div>
        <div class="mb-2">ì£¼ì†Œ: <span id="detailAddress"></span></div>
        <div class="mb-2">ìƒíƒœ: <span id="detailStatus"></span></div>
        <div class="mb-2">ê°€ê²Œ ìš”ì²­ì‚¬í•­: <span id="detailStoreRequest"></span></div>
        <div class="mb-2">ë°°ë‹¬ ìš”ì²­ì‚¬í•­: <span id="detailDeliveryRequest"></span></div>
        <div class="mb-2">ì´ ê¸ˆì•¡: <span id="detailTotalPrice"></span></div>
        <div class="text-end mt-4">
          <button id="confirmBtn" class="btn btn-outline-success btn-sm me-2" style="display:none;">ì ‘ìˆ˜í•˜ê¸°</button>
          <button id="cancelBtn" class="btn btn-outline-danger btn-sm me-2" style="display:none;">ì£¼ë¬¸ì·¨ì†Œ</button>
          <button id="completeBtn" class="btn btn-outline-primary btn-sm me-2" style="display:none;">ì¡°ë¦¬ì™„ë£Œ</button>
          <button id="startDeliveryBtn" class="btn btn-outline-warning btn-sm" style="display:none;">ë°°ë‹¬ì‹œì‘</button>
        </div>
      </div>
    </div>
  </div>
<!-- ìƒˆ ì£¼ë¬¸ ë„ì°© ëª¨ë‹¬ (Bootstrap Modal) -->
<div
  class="modal fade"
  id="newOrderPopup"
  tabindex="-1"
  aria-labelledby="newOrderPopupLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div class="modal-header">
        <h5 class="modal-title" id="newOrderPopupLabel">ìƒˆ ì£¼ë¬¸ ë„ì°©!</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <!-- ëª¨ë‹¬ ë°”ë”” -->
      <div class="modal-body">
        <p>ì£¼ë¬¸ ì •ë³´: <span id="orderInfo"></span></p>
        <p>ì˜µì…˜: <span id="orderOptions"></span></p>
        <p>ìˆ˜ëŸ‰: <span id="orderCount"></span></p>
        <p>ê¸ˆì•¡: <span id="orderPrice"></span></p>
        <hr />
        <p>ê°€ê²Œ ìš”ì²­ì‚¬í•­: <span id="storeRequest"></span></p>
        <p>ë°°ë‹¬ ìš”ì²­ì‚¬í•­: <span id="deliveryRequest"></span></p>
        <p>ìˆ˜ì € í¬í•¨ ì—¬ë¶€: <span id="needSpoon"></span></p>
        <hr />
        <p>ì£¼ë¬¸ë²ˆí˜¸: <span id="orderId"></span></p>
        <p>ì—°ë½ì²˜: <span id="contactNumber"></span></p>
        <p>ë°°ë‹¬ ì£¼ì†Œ: <span id="address"></span></p>
        <hr />
        <!-- ë°°ë‹¬ ì™„ë£Œ ì˜ˆì • ì‹œê°„(5ë¶„ ê°„ê²© ì¡°ì ˆ) -->
        <div class="mb-3">
          <button
            type="button"
            class="btn btn-outline-primary btn-sm"
            onclick="changeTime(-5)"
          >
            -5ë¶„
          </button>
          <input
            type="text"
            id="completionTime"
            value="0"
            size="4"
            class="text-center"
          />
          <button
            type="button"
            class="btn btn-outline-primary btn-sm"
            onclick="changeTime(5)"
          >
            +5ë¶„
          </button>
        </div>
      </div>
      <!-- ëª¨ë‹¬ í‘¸í„° -->
      <div class="modal-footer">
        <!-- ì£¼ë¬¸ ì ‘ìˆ˜ & ê±°ë¶€ ë²„íŠ¼ -->
        <button
          type="button"
          class="btn btn-success"
          id="acceptBtn"
        >
          ì ‘ìˆ˜
        </button>
        <button
          type="button"
          class="btn btn-danger"
          id="rejectBtn"
        >
          ê±°ë¶€
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>
</div>

<script>
$(function() {
    // 1) í˜ì´ì§€ ë¡œë“œ ì‹œ, ì„œë²„ì—ì„œ ì „ì²´ ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜´
    loadOrderList();
    
    // 2) ì™¼ìª½ ëª©ë¡ í´ë¦­ ì‹œ -> ì˜¤ë¥¸ìª½ ìƒì„¸ í‘œì‹œ
    //    (ë™ì  li íƒœê·¸ì´ë¯€ë¡œ, ì´ë²¤íŠ¸ ìœ„ì„)
    $(document).on('click', '.order-item', function() {
        const orderId = $(this).data('orderid');
        loadOrderDetail(orderId);
    });
    
    // 3) ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    $('#confirmBtn').on('click', function() {
        const orderId = $('#detailOrderId').text();
        updateOrderStatus(orderId, '/owner/order/accept');
    });
    $('#cancelBtn').on('click', function() {
        const orderId = $('#detailOrderId').text();
        updateOrderStatus(orderId, '/owner/order/reject');
    });
    $('#completeBtn').on('click', function() {
        const orderId = $('#detailOrderId').text();
        updateOrderStatus(orderId, '/owner/order/complete');
    });
});

// ì£¼ë¬¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
function loadOrderList() {
    $.ajax({
        url: '/owner/order/list',
        method: 'GET',
        success: function(orderList) {
            renderOrderList(orderList);
        },
        error: function(err) {
            console.error(err);
        }
    });
}

// ì™¼ìª½ ì£¼ë¬¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderOrderList(orderList) {
	$('#newOrderList, #processingOrderList, #deliveringOrderList').empty();

  orderList.forEach(order => {
    const orderText = $('<div>').addClass('order-text')
      .html(`ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}<br>ì´ ê¸ˆì•¡: ${order.totalPrice}ì›`);

    const buttonWrap = $('<div>').addClass('order-buttons ms-auto d-flex align-items-center');

    if (order.orderStatus === 'PENDING') {
      const acceptBtn = $('<button>')
        .addClass('acceptBtn')
        .attr('data-orderid', order.orderId)
        .text('ì ‘ìˆ˜');
      const rejectBtn = $('<button>')
        .addClass('rejectBtn')
        .attr('data-orderid', order.orderId)
        .text('ê±°ë¶€');

      // ì‹œê°„ ì¡°ì ˆ UI
      const timeAdjust = $('<div>').addClass('time-adjust d-inline-flex align-items-center ms-2');
      const minusBtn = $('<button>')
        .addClass('btn btn-sm btn-outline-secondary px-2')
        .text('-')
        .on('click', function () {
          const input = $(this).siblings('input');
          input.val(Math.max(0, parseInt(input.val()) - 5));
        });
      const timeInput = $('<input>')
        .attr({ type: 'text', value: '0', size: '2', readonly: true })
        .addClass('form-control form-control-sm text-center mx-1');
      const plusBtn = $('<button>')
        .addClass('btn btn-sm btn-outline-secondary px-2')
        .text('+')
        .on('click', function () {
          const input = $(this).siblings('input');
          input.val(parseInt(input.val()) + 5);
        });

      timeAdjust.append(minusBtn, timeInput, plusBtn);

      buttonWrap.append(acceptBtn, rejectBtn, timeAdjust);

      const li = $('<li>')
        .addClass('order-item')
        .attr('data-orderid', order.orderId)
        .append(orderText)
        .append(buttonWrap);

      $('#newOrderList').prepend(li);
    }

    else if (order.orderStatus === 'CONFIRMED') {
    	  const extendTimeBtn = $('<button>')
    	    .addClass('extendTimeBtn')
    	    .attr('data-orderid', order.orderId)
    	    .text('ì‹œê°„ ì¶”ê°€');

    	  const completeBtn = $('<button>')
    	    .addClass('completeBtn')
    	    .attr('data-orderid', order.orderId)
    	    .text('ì¡°ë¦¬ ì™„ë£Œ');

    	  // âœ… íƒ€ì´ë¨¸ ì»¨í…Œì´ë„ˆ ì¶”ê°€
    	  const timerContainer = $('<div>').addClass('countdown-timer').append(
    	    $('<div>').addClass('circle').append(
    	      $('<div>').addClass('inside-text').text('--')
    	    )
    	  );

    	  const buttonWrap = $('<div>')
    	    .addClass('order-buttons ms-auto d-flex align-items-center')
    	    .append(timerContainer, extendTimeBtn, completeBtn);

    	  const orderText = $('<div>').addClass('order-text')
    	    .html(`ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}<br>ì´ ê¸ˆì•¡: ${order.totalPrice}ì›`);

    	  const li = $('<li>')
    	    .addClass('order-item')
    	    .attr('data-orderid', order.orderId)
    	    .append(orderText)
    	    .append(buttonWrap);

    	  $('#processingOrderList').prepend(li);

    	  // âœ… íƒ€ì´ë¨¸ ì‹œì‘ (ì˜ˆ: ê¸°ë³¸ 20ë¶„ìœ¼ë¡œ ì„¸íŒ…)
    	  startCountdown(timerContainer[0], 20);
    	}
    
    else if (order.orderStatus === 'IN_DELIVERY') {
        const startBtn = $('<button>').addClass('startDeliveryBtn').attr('data-orderid', order.orderId).text('ë°°ë‹¬ì‹œì‘');
        buttonWrap.append(startBtn);
        li.append(orderText, buttonWrap);
        $('#deliveringOrderList').append(li);
      }
  });
}

function startCountdown(timerElem, minutesLeft) {
	  const circle = timerElem.querySelector('.circle');
	  const text = timerElem.querySelector('.inside-text');
	  const endTime = Date.now() + minutesLeft * 60000;

	  function update() {
	    const remaining = endTime - Date.now();
	    const percent = Math.max((remaining / (minutesLeft * 60000)) * 100, 0);
	    const min = Math.floor(remaining / 60000);
	    circle.style.setProperty('--progress', percent);

	    if (remaining <= 0) {
	      circle.classList.add('overdue');
	      text.textContent = '+' + Math.abs(min) + 'ë¶„';
	    } else {
	      text.textContent = min + 'ë¶„';
	      requestAnimationFrame(update);
	    }
	  }

	  update();

	  const interval = setInterval(() => {
	    update();
	    if (Date.now() - endTime > 600000) clearInterval(interval); // 10ë¶„ ì´ˆê³¼ ì‹œ ë©ˆì¶¤
	  }, 1000);
	}
function startTimer(elemId, minutes) {
    const circleLength = 125.66;
    let timeLeft = minutes * 60;
    const elem = $('#' + elemId);

    function updateCircle() {
        const percent = timeLeft / (minutes * 60);
        elem.text(Math.ceil(timeLeft / 60));
        elem.css('background', `conic-gradient(#007bff ${percent * 360}deg, #eee 0deg)`);
        timeLeft--;
        if (timeLeft >= 0) setTimeout(updateCircle, 1000);
    }

    updateCircle();
}

// íŠ¹ì • ì£¼ë¬¸ ìƒì„¸ ë¶ˆëŸ¬ì˜¤ê¸°
function loadOrderDetail(orderId) {
    // ì´ë¯¸ /owner/order/list ë¡œ ë°›ì•„ì˜¨ ëª©ë¡ì—ì„œ ì°¾ëŠ” ì‹ìœ¼ë¡œ í•´ë„ ë˜ê³ ,
    // ì„œë²„ APIë¥¼ ë§Œë“¤ì–´ë„ ë©ë‹ˆë‹¤. ì—¬ê¸°ì„  ê°„ë‹¨íˆ í•˜ë‚˜ì˜ ì£¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° API ì˜ˆì‹œ
	$.ajax({
	    url: '/owner/order/detail?orderId=' + orderId,
	    method: 'GET',
	    success: function(order) {
	        renderOrderDetail(order); // ğŸ‘ˆ ì´ê²Œ ì‹¤ì œë¡œ ìƒì„¸ì— ë°ì´í„°ë¥¼ ë„£ìŒ
	    },
	    error: function(err) {
	        console.error(err);
	    }
	});
}

// ì£¼ë¬¸ ìƒì„¸ í‘œì‹œ
function renderOrderDetail(order) {
  $('#detailOrderId').text(order.orderId);
  $('#detailAddress').text(order.deliveryAddress);
  $('#detailStatus').text(order.orderStatus);
  $('#detailStoreRequest').text(order.storeRequest);
  $('#detailDeliveryRequest').text(order.deliveryRequest);
  $('#detailTotalPrice').text(order.totalPrice);

  $('#confirmBtn, #cancelBtn, #completeBtn, #startDeliveryBtn').hide();

  if (order.orderStatus === 'PENDING') {
    $('#confirmBtn, #cancelBtn').show();
  } else if (order.orderStatus === 'CONFIRMED') {
    $('#completeBtn, #cancelBtn').show();
  } else if (order.orderStatus === 'IN_DELIVERY') {
    $('#startDeliveryBtn').show();
  }
}

// ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateOrderStatus(orderId, url) {
    $.ajax({
        url: url,
        method: 'POST',
        data: { orderId: orderId },
        success: function(updatedOrder) {
            // alert('ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì„±ê³µ: ' + updatedOrder.orderStatus);
            renderOrderDetail(updatedOrder); // ìƒì„¸ ì˜ì—­ ê°±ì‹ 
            
            // ë¦¬ìŠ¤íŠ¸ë„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜´
            loadOrderList();
        },
        error: function(err) {
            console.error(err);
        }
    });
}
//    let stompClient = null;
//    const storeId = /* [[${storeId}]] */ '1'; // ì‹¤ì œ ë¡œê·¸ì¸ ì—…ì£¼ì˜ ê°€ê²Œ ë²ˆí˜¸ë¡œ ì¹˜í™˜

/*     // WebSocket ì—°ê²°
    function connect() {
        const socket = new SockJS('/stomp');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);
            // /topic/store/ê°€ê²Œë²ˆí˜¸ êµ¬ë… (ìƒˆ ì£¼ë¬¸ ì•Œë¦¼ìš©)
            stompClient.subscribe('/topic/store/' + storeId, function(message) {
                const orderData = JSON.parse(message.body);
                showNewOrderPopup(orderData);
            });
        });
    } */
    
    let stompClient = null;
    const storeId = '11111111-1111-1111-1111-111111111111'; // í…ŒìŠ¤íŠ¸ìš© ê°€ê²Œ UUID

    function connect() {
        const socket = new SockJS('/stomp');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);
            // /topic/store/{storeId} êµ¬ë…
            stompClient.subscribe('/topic/store/' + storeId, function(message) {
                const orderData = JSON.parse(message.body);
                showNewOrderPopup(orderData);
            });
        });
    }
    
    function showNewOrderPopup(order) {
        alert('ìƒˆ ì£¼ë¬¸ ë„ì°©: ' + JSON.stringify(order));
        // ì—¬ê¸°ì„œ íŒì—… ë“±ì„ ë„ìš°ëŠ” ë¡œì§ ìˆ˜í–‰
    }


    // ìƒˆ ì£¼ë¬¸ íŒì—… í‘œì‹œ
    function showNewOrderPopup(order) {
    	// ì£¼ë¬¸ ì •ë³´ í‘œì‹œ
        $('#orderInfo').text(order.menuNameList);
        $('#orderOptions').text(order.options);
        $('#orderCount').text(order.totalCount);
        $('#orderPrice').text(order.totalPrice);

        $('#storeRequest').text(order.storeRequest);
        $('#deliveryRequest').text(order.deliveryRequest);
        $('#needSpoon').text(order.needSpoon ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤');

        $('#orderId').text(order.id);
        $('#contactNumber').text(order.contactNumber);
        $('#address').text(order.address);

        // ëª¨ë‹¬ ì—´ê¸°
        newOrderModal.show();
        
     	// 2) ë¦¬ìŠ¤íŠ¸ì—ë„ ì¶”ê°€ (ì‹ ê·œ ì£¼ë¬¸ì´ë¯€ë¡œ PENDING ìƒíƒœ ê°€ì •)
        addOrderToList(order);

        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
        $('#acceptBtn').off('click').on('click', function() {
            acceptOrder(order.id, $('#completionTime').val());
        });
        $('#rejectBtn').off('click').on('click', function() {
            rejectOrder(order.id);
        });
    }
	
    function addOrderToList(order) {
        // orderStatus í™•ì¸ (ì˜ˆ: PENDING, CONFIRMED, IN_DELIVERY ...)
        // ë§Œì•½ order.orderStatusê°€ ì—†ìœ¼ë©´ "PENDING"ìœ¼ë¡œ ê°„ì£¼ (ìƒˆ ì£¼ë¬¸)
        const status = order.orderStatus || 'PENDING';

        // li íƒœê·¸ ìƒì„±
        const li = $('<li>')
            .addClass('order-item')
            .attr('data-orderid', order.id)
            .text('ì£¼ë¬¸ë²ˆí˜¸: ' + order.id + ', ì´ê¸ˆì•¡: ' + order.totalPrice);

        if (status === 'PENDING') {
            $('#newOrderList').prepend(li);
        } else if (status === 'CONFIRMED' || status === 'IN_DELIVERY') {
            $('#processingOrderList').prepend(li);
        }
        // í•„ìš”í•˜ë©´ COMPLETED, CANCELED ì„¹ì…˜ë„ ì²˜ë¦¬
    }
    
    function closeNewOrderPopup() {
        // ëª¨ë‹¬ ë‹«ê¸°
        if (newOrderModal) {
            newOrderModal.hide();
        }
    }

    // ë°°ë‹¬ ì™„ë£Œì‹œê°„ + - ë²„íŠ¼ ì¡°ì ˆ (5ë¶„ ë‹¨ìœ„)
    function changeTime(minute) {
        let current = parseInt($('#completionTime').val(), 10);
        if (isNaN(current)) current = 0;
        $('#completionTime').val(current + minute);
    }

    // ì£¼ë¬¸ ì ‘ìˆ˜
	function acceptOrder(orderId, completionTime) {
	    $.ajax({
	        url: '/owner/order/accept',
	        type: 'POST',
	        contentType: 'application/json', // âœ… ì¶”ê°€
	        data: JSON.stringify({ orderId: orderId, completionTime: completionTime }), // âœ… JSONìœ¼ë¡œ ë³€í™˜
	        success: function(updatedOrder) {
	            alert('ì£¼ë¬¸ ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
	            closeNewOrderPopup();
	            removeOrderFromList(updatedOrder.id);
	            addOrderToList(updatedOrder);
	        },
	        error: function(err) {
	            console.error('ì ‘ìˆ˜ ì‹¤íŒ¨:', err);
	            alert('ì ‘ìˆ˜ ì‹¤íŒ¨: ' + err.responseText);
	        }
	    });
	}
    
	function removeOrderFromList(orderId) {
	    // data-orderid ì†ì„±ì´ orderIdì¸ li ìš”ì†Œë¥¼ ì°¾ì•„ ì œê±°
	    $('#newOrderList li, #processingOrderList li').each(function() {
	        if ($(this).data('orderid') === orderId) {
	            $(this).remove();
	        }
	    });
	}

    // ì£¼ë¬¸ ê±°ë¶€
	function rejectOrder(orderId) {
	    $.ajax({
	        url: '/owner/order/reject',
	        type: 'POST',
	        contentType: 'application/json', // âœ… ì¶”ê°€
	        data: JSON.stringify({ orderId: orderId }), // âœ… JSON ë¬¸ìì—´ë¡œ
	        success: function(response) {
	            alert('ì£¼ë¬¸ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
	            closeNewOrderPopup();
	        },
	        error: function(err) {
	            console.error('ê±°ë¶€ ì‹¤íŒ¨:', err);
	            alert('ê±°ë¶€ ì‹¤íŒ¨: ' + err.responseText);
	        }
	    });
	}
    
	function extendTime(orderId, minutes) {
	    $.ajax({
	        url: '/owner/order/extendTime',
	        method: 'POST',
	        data: { orderId: orderId, minutes: minutes },
	        success: function(updatedOrder) {
	            alert('ì‹œê°„ ì¶”ê°€ ì™„ë£Œ.');
	            // updatedOrderì— ìƒˆë¡œìš´ ì™„ë£Œ ì‹œê°„ì´ ìˆìœ¼ë©´ ìƒì„¸í™”ë©´ ë“± ì—…ë°ì´íŠ¸ ê°€ëŠ¥
	            loadOrderList();
	        }	
	    });
	}

	function completeOrder(orderId) {
	    $.ajax({
	        url: '/owner/order/complete',
	        method: 'POST',
	        data: { orderId: orderId },
	        success: function(updatedOrder) {
	            alert('ì¡°ë¦¬ ì™„ë£Œ');
	            loadOrderList();
	        }
	    });
	}

    // í˜ì´ì§€ ë¡œë“œ ì‹œ WebSocket ì—°ê²°
    $(document).ready(function() {
        // Bootstrap Modal ê°ì²´ ìƒì„±
        const modalElem = document.getElementById('newOrderPopup');
        newOrderModal = new bootstrap.Modal(modalElem, {
            backdrop: 'static', // ëª¨ë‹¬ ë°– í´ë¦­í•´ë„ ë‹«íˆì§€ ì•Šë„ë¡
            keyboard: false     // ESCë¡œ ë‹«íˆì§€ ì•Šë„ë¡
        });
        
        // WebSocket ì—°ê²°, etc.
        connect();
    });
</script>

</body>
</html>